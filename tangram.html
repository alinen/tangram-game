<html>
<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
}

#container {
  position: relative;
  width: 100vw;
  height: 100vh;
}

#svgObject, #overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

#overlay {
  pointer-events: none; /* clicks go to SVG */
}
</style>
<body>

<div id="container">
  <object id="svgObject" 
          data="puzzle-rocket.svg" 
          type="image/svg+xml" 
          preserveAspectRatio="xMidYMid meet"
          onload="start()">
  </object>
  <canvas id="overlay"></canvas>
</div>

<script>
const canvas = document.getElementById("overlay");
const ctx = canvas.getContext("2d");
var svgDoc = null;

var gameOverMessage = "You win!";
var gameOver = false;


class PuzzlePiece
{
  constructor(svgElement)
  {
    this.el = svgElement;
    this.bbox = this.el.getBBox();     
    console.log("puzzle piece:" + this.el.id);
    console.log(`puzzle bbox: ${this.bbox.x} ${this.bbox.y} ${this.bbox.width} ${this.bbox.height}`);
  }

  move(x, y) {
    var attrval =  `translate(${x} ${y})`;
    this.el.setAttribute("transform", attrval);
  }
}
var puzzlePieces = [];
var selectedPiece = null;

function start() {
  console.log("start");
  const obj = document.getElementById("svgObject");
  svgDoc = obj.contentDocument;
  if (!svgDoc) {
    console.logError("Error: No SVG document found.");
    return;
  }

  const svg = svgDoc.querySelector("svg");
  //const width = svg.viewBox.baseVal.width;
  //const height = svg.viewBox.baseVal.height;

  const puzzleLayer = svgDoc.getElementById("PuzzleLayer");
  for (const el of puzzleLayer.children) {
    var piece = new PuzzlePiece(el);
    var i = Math.floor(Math.random() * 2); 
    var j = Math.floor(Math.random() * 4); 
    var x = 300 + 75 * j;
    var y = 150 * i;
    piece.move(x, y);
    puzzlePieces.push(piece);
  }
 
}

function resize() {
  canvas.width  = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
  draw();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (gameOver)
  {
    ctx.font = "64px Arial";
    ctx.textAlign = "center";
    ctx.lineWidth = 2;
    ctx.fillStyle = "red";
    ctx.strokeStyle = "black";
    ctx.fillText(gameOverMessage, canvas.width/2, canvas.height/2);
    ctx.strokeText(gameOverMessage, canvas.width/2, canvas.height/2);
  }
}

window.addEventListener("resize", resize);
resize();
</script>


</body>
</html>